{% extends "layout.html" %}
{% block title %}Home{% endblock %}
{% block extraheader %}{% endblock %}
{% block body %}
	<div class="jumbotron">
		<h1>Music recommendations</h1>
		<p class="lead">Discover new music!</p>
	</div>		
		<div class="panel panel-default">
			<div class="panel-body">
				<form action="{{url_for('artist_search_page',_external=True)}}" method="post" name="search">
					<div class="input-group">
						Search:<br>{{ form.searchbox(size=40) }}<br>
						
						<button type="submit" class="btn btn-md btn-primary"><span class="glyphicon glyphicon-search" aria-hidden="true"> Search</button>
					</div>
				</form>
			</div>
		</div>
		
	<div class="panel panel-default">
			<div class="panel-heading">Trending Songs</div>
			<div class="panel-body">
	
				<div class="row">
			
				{% for song in tren_song %}
				<div class="col-md-1">
					<a href="{{song.url|safe}}">
						<img class="img-thumbnail" src="http://img.youtube.com/vi/{{song.youtubeId|safe}}/0.jpg"></img>{{song.songName|safe}}
					</a>
				</div>
				{% endfor %}
			</div>
		</div>
	</div>
	
	<div class="panel panel-default">
			<div class="panel-heading">Trending Artists</div>
	  <div class="panel-body">
		
		<div class="row">
			{% for trena in tren_artist %}
			 <div id='trendiv{{trena.id}}' class="col-md-1">
					<img id='trendiv{{trena.id}}thumb' class="img-thumbnail" src="{{ url_for('static', filename='images/empty.jpg') }}"></img>
				{{trena.name|safe}}
			</div>
			{% endfor %}
		</div>

	  </div>
	</div>
	
	<div class="panel panel-default">
			<div class="panel-heading">Popular Songs</div>
			<div class="panel-body">
	
				<div class="row">
			
				{% for song in popu_song %}
				<div class="col-md-1">
					<a href="{{song.url|safe}}">
						<img class="img-thumbnail" src="http://img.youtube.com/vi/{{song.youtubeId|safe}}/0.jpg"></img>{{song.songName|safe}}
					</a>
				</div>
				{% endfor %}
			</div>
		</div>
	</div>
	
	<div class="panel panel-default">
			<div class="panel-heading">Popular Artists</div>
	  <div class="panel-body">
		
		<div class="row">
			{% for popu in popu_artist %}
			 <div id='popdiv{{popu.id}}' class="col-md-1">
				<img id='popdiv{{popu.id}}thumb' class="img-thumbnail" src="{{ url_for('static', filename='images/empty.jpg') }}"></img>
				{{popu.name|safe}}
			</div>
			{% endfor %}
		</div>

	  </div>
	</div>
	
{% endblock %}


{% block afterboxy %}

<script type='text/javascript'>
	function debounce(fn, delay) {
	  var timer = null;
	  return function () {
		var context = this, args = arguments;
		clearTimeout(timer);
		timer = setTimeout(function () {
		  fn.apply(context, args);
		}, delay);
	  };
	}

	function set_artist_thumbnail(artist_id,sel){
		// set artist thumbnail
			$.ajax({
				url: 'http://'+document.domain + ':' + location.port+'/albumcovers/id/'+artist_id+'/1',
				method: "GET",
				success: function(data) {
					
					var data=$.parseJSON( data );
					
					var url = '';
					
					if(data.length>0){
						url=data[0];
						console.log(url);
					}
					
					if(url!=''){
						$(sel).attr('src',url);
					}
					
					
				}
			}
		);
	}

	
	$(document).ready(function() {
		 ('{{artist_id}}','#artist_thumb');
		
		{% for tre in tren_artist %}
			$('#trendiv{{tre.id}}').wrap('<a href="{{ url_for('artist_page',id=tre.id) }}"></a>');
			set_artist_thumbnail('{{tre.id}}','#trendiv{{tre.id}}thumb');
		{% endfor %}
		{% for popu in popu_artist %}
			$('#popdiv{{popu.id}}').wrap('<a href="{{ url_for('artist_page',id=popu.id) }}"></a>');
			set_artist_thumbnail('{{popu.id}}','#popdiv{{popu.id}}thumb');
		{% endfor %}
	
	});
</script>

{% endblock %}
